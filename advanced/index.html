
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.rke2.io/advanced/">
      
      <link rel="icon" href="../assets/favicon-32x32.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.3">
    
    
      
        <title>Advanced Options and Configuration - RKE2 - Rancher's Next Generation Kubernetes Distribution</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Work Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-options-and-configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="RKE2 - Rancher&#39;s Next Generation Kubernetes Distribution" class="md-header__button md-logo" aria-label="RKE2 - Rancher's Next Generation Kubernetes Distribution" data-md-component="logo">
      
  <img src="../assets/logo-stacked-white-rke2.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RKE2 - Rancher's Next Generation Kubernetes Distribution
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Advanced Options and Configuration
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/rancher/rke2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="RKE2 - Rancher&#39;s Next Generation Kubernetes Distribution" class="md-nav__button md-logo" aria-label="RKE2 - Rancher's Next Generation Kubernetes Distribution" data-md-component="logo">
      
  <img src="../assets/logo-stacked-white-rke2.svg" alt="logo">

    </a>
    RKE2 - Rancher's Next Generation Kubernetes Distribution
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rancher/rke2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/requirements/" class="md-nav__link">
        Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/ha/" class="md-nav__link">
        High Availability
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          Install Options
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Install Options" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Install Options
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/install_options/install_options/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/install_options/server_config/" class="md-nav__link">
        Server Configuration Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/install_options/linux_agent_config/" class="md-nav__link">
        Agent Configuration Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/install_options/windows_agent_config/" class="md-nav__link">
        Windows Agent Configuration Reference
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/methods/" class="md-nav__link">
        Installation Methods
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/network_options/" class="md-nav__link">
        Network Options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/containerd_registry_configuration/" class="md-nav__link">
        Containerd Registry Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/airgap/" class="md-nav__link">
        Air-Gap Install
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/windows_airgap/" class="md-nav__link">
        Windows Air-Gap Install
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/linux_uninstall/" class="md-nav__link">
        Linux Uninstall
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/windows_uninstall/" class="md-nav__link">
        Windows Uninstall
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Upgrades
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Upgrades" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Upgrades
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upgrade/upgrade/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upgrade/basic_upgrade/" class="md-nav__link">
        Upgrade Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upgrade/automated_upgrade/" class="md-nav__link">
        Automated Upgrades
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Security
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Security" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/about_hardened_images/" class="md-nav__link">
        About Hardened Images
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/hardening_guide/" class="md-nav__link">
        CIS Hardening Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/cis_self_assessment16/" class="md-nav__link">
        CIS v1.6 Self-Assessment Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/fips_support/" class="md-nav__link">
        FIPS 140-2 Enablement
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/policies/" class="md-nav__link">
        Default Policy Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/selinux/" class="md-nav__link">
        SELinux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/secrets_encryption/" class="md-nav__link">
        Secrets Encryption
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Architecture" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/architecture/" class="md-nav__link">
        Anatomy of a Next Generation Kubernetes Distribution
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cluster_access/" class="md-nav__link">
        Cluster Access
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../backup_restore/" class="md-nav__link">
        Etcd Backup and Restore
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../networking/" class="md-nav__link">
        Networking
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../helm/" class="md-nav__link">
        Helm Integration
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Advanced Options and Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Advanced Options and Configuration
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#certificate-rotation" class="md-nav__link">
    Certificate Rotation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auto-deploying-manifests" class="md-nav__link">
    Auto-Deploying Manifests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-containerd" class="md-nav__link">
    Configuring containerd
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-an-http-proxy" class="md-nav__link">
    Configuring an HTTP proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node-labels-and-taints" class="md-nav__link">
    Node Labels and Taints
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../subcommands/" class="md-nav__link">
        Subcommands
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../known_issues/" class="md-nav__link">
        Known Issues and Limitations
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#certificate-rotation" class="md-nav__link">
    Certificate Rotation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auto-deploying-manifests" class="md-nav__link">
    Auto-Deploying Manifests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-containerd" class="md-nav__link">
    Configuring containerd
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-an-http-proxy" class="md-nav__link">
    Configuring an HTTP proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node-labels-and-taints" class="md-nav__link">
    Node Labels and Taints
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/rancher/rke2/edit/master/docs/advanced.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="advanced-options-and-configuration">Advanced Options and Configuration<a class="headerlink" href="#advanced-options-and-configuration" title="Permanent link">&para;</a></h1>
<p>This section contains advanced information describing the different ways you can run and manage RKE2.</p>
<h2 id="certificate-rotation">Certificate Rotation<a class="headerlink" href="#certificate-rotation" title="Permanent link">&para;</a></h2>
<p>By default, certificates in RKE2 expire in 12 months.</p>
<p>If the certificates are expired or have fewer than 90 days remaining before they expire, the certificates are rotated when RKE2 is restarted.</p>
<p>As of v1.21.8+rke2r1, certificates can also be rotated manually. To do this, it is best to stop the rke2-server process, rotate the certificates, then start the process up again: 
<div class="highlight"><pre><span></span><code>systemctl stop rke2-server
rke2 certificate rotate
systemctl start rke2-server
</code></pre></div>
It is also possible to rotate an individual service by passing the <code>--service</code> flag, for example: <code>rke2 certificate rotate --service api-server</code>. See the <a href="https://docs.rke2.io/subcommands/#certificate">certificate subcommand</a> for more details.</p>
<h2 id="auto-deploying-manifests">Auto-Deploying Manifests<a class="headerlink" href="#auto-deploying-manifests" title="Permanent link">&para;</a></h2>
<p>Any file found in <code>/var/lib/rancher/rke2/server/manifests</code> will automatically be deployed to Kubernetes in a manner similar to <code>kubectl apply</code>.</p>
<p>For information about deploying Helm charts using the manifests directory, refer to the section about <a href="../helm/">Helm.</a></p>
<h2 id="configuring-containerd">Configuring containerd<a class="headerlink" href="#configuring-containerd" title="Permanent link">&para;</a></h2>
<p>RKE2 will generate the <code>config.toml</code> for containerd in <code>/var/lib/rancher/rke2/agent/etc/containerd/config.toml</code>.</p>
<p>For advanced customization of this file you can create another file called <code>config.toml.tmpl</code> in the same directory and it will be used instead.</p>
<p>The <code>config.toml.tmpl</code> will be treated as a Go template file, and the <code>config.Node</code> structure is being passed to the template. See <a href="https://github.com/k3s-io/k3s/blob/master/pkg/agent/templates/templates.go#L16-L32">this template</a> for an example of how to use the structure to customize the configuration file.</p>
<h2 id="configuring-an-http-proxy">Configuring an HTTP proxy<a class="headerlink" href="#configuring-an-http-proxy" title="Permanent link">&para;</a></h2>
<p>If you are running RKE2 in an environment, which only has external connectivity through an HTTP proxy, you can configure your proxy settings on the RKE2 systemd service. These proxy settings will then be used in RKE2 and passed down to the embedded containerd and kubelet.</p>
<p>Add the necessary <code>HTTP_PROXY</code>, <code>HTTPS_PROXY</code> and <code>NO_PROXY</code> variables to the environment file of your systemd service, usually:</p>
<ul>
<li><code>/etc/default/rke2-server</code></li>
<li><code>/etc/default/rke2-agent</code></li>
</ul>
<p>The <code>NO_PROXY</code> variable must include your internal networks, as well as the cluster pod and service IP ranges.</p>
<div class="highlight"><pre><span></span><code>HTTP_PROXY=http://your-proxy.example.com:8888
HTTPS_PROXY=http://your-proxy.example.com:8888
NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,.svc,.cluster.local
</code></pre></div>
<p>If you want to configure the proxy settings for containerd without affecting RKE2 and the Kubelet, you can prefix the variables with <code>CONTAINERD_</code>:</p>
<div class="highlight"><pre><span></span><code>CONTAINERD_HTTP_PROXY=http://your-proxy.example.com:8888
CONTAINERD_HTTPS_PROXY=http://your-proxy.example.com:8888
CONTAINERD_NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,.svc,.cluster.local
</code></pre></div>
<h2 id="node-labels-and-taints">Node Labels and Taints<a class="headerlink" href="#node-labels-and-taints" title="Permanent link">&para;</a></h2>
<p>RKE2 agents can be configured with the options <code>node-label</code> and <code>node-taint</code> which adds a label and taint to the kubelet. The two options only add labels and/or taints at registration time, and can only be added once and not removed after that through rke2 commands.</p>
<p>If you want to change node labels and taints after node registration you should use <code>kubectl</code>. Refer to the official Kubernetes documentation for details on how to add <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">taints</a> and <a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#add-a-label-to-a-node">node labels</a>.</p>
<h1 id="how-agent-node-registration-works">How Agent Node Registration Works<a class="headerlink" href="#how-agent-node-registration-works" title="Permanent link">&para;</a></h1>
<p>Agent nodes are registered via a websocket connection initiated by the <code>rke2 agent</code> process, and the connection is maintained by a client-side load balancer running as part of the agent process.</p>
<p>Agents register with the server using the cluster secret portion of the join token, along with a randomly generated node-specific password, which is stored on the agent at <code>/etc/rancher/node/password</code>. The server will store the passwords for individual nodes as Kubernetes secrets, and any subsequent attempts must use the same password. Node password secrets are stored in the <code>kube-system</code> namespace with names using the template <code>&lt;host&gt;.node-password.rke2</code>. These secrets are deleted when the corresponding Kubernetes node is deleted.</p>
<p>Note: Prior to RKE2 v1.20.2 servers stored passwords on disk at <code>/var/lib/rancher/rke2/server/cred/node-passwd</code>.</p>
<p>If the <code>/etc/rancher/node</code> directory of an agent is removed, the password file should be recreated for the agent prior to startup, or the entry removed from the server or Kubernetes cluster (depending on the RKE2 version).</p>
<h2 id="starting-the-server-with-the-installation-script">Starting the Server with the Installation Script<a class="headerlink" href="#starting-the-server-with-the-installation-script" title="Permanent link">&para;</a></h2>
<p>The installation script provides units for systemd, but does not enable or start the service by default.</p>
<p>When running with systemd, logs will be created in <code>/var/log/syslog</code> and viewed using <code>journalctl -u rke2-server</code> or <code>journalctl -u rke2-agent</code>.</p>
<p>An example of installing with the install script:</p>
<div class="highlight"><pre><span></span><code>curl -sfL https://get.rke2.io <span class="p">|</span> sh -
systemctl <span class="nb">enable</span> rke2-server
systemctl start rke2-server
</code></pre></div>
<h2 id="disabling-server-charts">Disabling Server Charts<a class="headerlink" href="#disabling-server-charts" title="Permanent link">&para;</a></h2>
<p>The server charts bundled with <code>rke2</code> deployed during cluster bootstrapping can be disabled and replaced with alternatives.  A common use case is replacing the bundled <code>rke2-ingress-nginx</code> chart with an alternative.</p>
<p>To disable any of the bundled system charts, set the <code>disable</code> parameter in the config file before bootstrapping.  The full list of system charts to disable is below:</p>
<ul>
<li><code>rke2-canal</code></li>
<li><code>rke2-coredns</code></li>
<li><code>rke2-ingress-nginx</code></li>
<li><code>rke2-metrics-server</code></li>
</ul>
<p>Note that it is the cluster operator's responsibility to ensure that components are disabled or replaced with care, as the server charts play important roles in cluster operability.  Refer to the <a href="../architecture/architecture/#server-charts">architecture overview</a> for more information on the individual system charts role within the cluster.</p>
<h2 id="installation-on-classified-aws-regions-or-networks-with-custom-aws-api-endpoints">Installation on classified AWS regions or networks with custom AWS API endpoints<a class="headerlink" href="#installation-on-classified-aws-regions-or-networks-with-custom-aws-api-endpoints" title="Permanent link">&para;</a></h2>
<p>In public AWS regions, installing RKE2 with <code>--cloud-provider-name=aws</code> will ensure RKE2 is cloud-enabled, and capable of auto-provisioning certain cloud resources.</p>
<p>When installing RKE2 on classified regions (such as SC2S or C2S), there are a few additional pre-requisites to be aware of to ensure RKE2 knows how and where to securely communicate with the appropriate AWS endpoints:</p>
<ol>
<li>
<p>Ensure all the common AWS cloud-provider <a href="https://rancher.com/docs/rke/latest/en/config-options/cloud-providers/aws/">prerequisites</a> are met.  These are independent of regions and are always required.</p>
</li>
<li>
<p>Ensure RKE2 knows where to send API requests for <code>ec2</code> and <code>elasticloadbalancing</code> services by creating a <code>cloud.conf</code> file, the below is an example for the <code>us-iso-east-1</code> (C2S) region:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/rancher/rke2/cloud.conf</span><span class="w"></span>
<span class="p p-Indicator">[</span><span class="nv">Global</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="p p-Indicator">[</span><span class="nv">ServiceOverride &quot;ec2&quot;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Service=ec2</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Region=us-iso-east-1</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">URL=https://ec2.us-iso-east-1.c2s.ic.gov</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">SigningRegion=us-iso-east-1</span><span class="w"></span>
<span class="l l-Scalar l-Scalar-Plain">[ServiceOverride &quot;elasticloadbalancing&quot;]</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Service=elasticloadbalancing</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Region=us-iso-east-1</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">URL=https://elasticloadbalancing.us-iso-east-1.c2s.ic.gov</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">SigningRegion=us-iso-east-1</span><span class="w"></span>
</code></pre></div>
<p>Alternatively, if you are using <a href="https://docs.aws.amazon.com/vpc/latest/privatelink/endpoint-services-overview.html">private AWS endpoints</a>, ensure the appropriate <code>URL</code> is used for each of the private endpoints.</p>
<ol>
<li>Ensure the appropriate AWS CA bundle is loaded into the system's root ca trust store.  This may already be done for you depending on the AMI you are using.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># on CentOS/RHEL 7/8</span>
cp &lt;ca.pem&gt; /etc/pki/ca-trust/source/anchors/
update-ca-trust
</code></pre></div>
<ol>
<li>configure RKE2 to use the <code>aws</code> cloud-provider with the custom <code>cloud.conf</code> created in step 1:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># /etc/rancher/rke2/config.yaml</span><span class="w"></span>
<span class="nn">...</span><span class="w"></span>
<span class="nt">cloud-provider-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws</span><span class="w"></span>
<span class="nt">cloud-provider-config</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/rancher/rke2/cloud.conf&quot;</span><span class="w"></span>
<span class="nn">...</span><span class="w"></span>
</code></pre></div>
<ol>
<li>
<p><a href="../install/methods/">Install</a> RKE2 normally (most likely in an <a href="../install/airgap/">airgapped</a> capacity)</p>
</li>
<li>
<p>Validate successful installation by confirming the existence of AWS metadata on cluster node labels with <code>kubectl get nodes --show-labels</code></p>
</li>
</ol>
<h2 id="control-plane-component-resource-requestslimits">Control Plane Component Resource Requests/Limits<a class="headerlink" href="#control-plane-component-resource-requestslimits" title="Permanent link">&para;</a></h2>
<p>The following options are available under the <code>server</code> sub-command for RKE2. The options allow for specifying CPU requests and limits for the control plane components within RKE2.</p>
<div class="highlight"><pre><span></span><code>   --control-plane-resource-requests value       (components) Control Plane resource requests [$RKE2_CONTROL_PLANE_RESOURCE_REQUESTS]
   --control-plane-resource-limits value         (components) Control Plane resource limits [$RKE2_CONTROL_PLANE_RESOURCE_LIMITS]
</code></pre></div>
<p>Values are a comma-delimited list of <code>[controlplane-component]-(cpu|memory)=[desired-value]</code>. The possible values for <code>controlplane-component</code> are:
<div class="highlight"><pre><span></span><code>kube-apiserver
kube-scheduler
kube-controller-manager
kube-proxy
etcd
cloud-controller-manager
</code></pre></div></p>
<p>Thus, an example <code>--control-plane-resource-requests</code> or <code>--control-plane-resource-limits</code> value may look like:</p>
<div class="highlight"><pre><span></span><code>kube-apiserver-cpu=500m,kube-apiserver-memory=512M,kube-scheduler-cpu=250m,kube-scheduler-memory=512M,etcd-cpu=1000m
</code></pre></div>
<p>The unit values for CPU/memory are identical to Kubernetes resource units (See: <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-units-in-kubernetes">Resource Limits in Kubernetes</a>)</p>
<h2 id="extra-control-plane-component-volume-mounts">Extra Control Plane Component Volume Mounts<a class="headerlink" href="#extra-control-plane-component-volume-mounts" title="Permanent link">&para;</a></h2>
<p>The following options are available under the <code>server</code> sub-command for RKE2. These options specify host-path mounting of directories from the node filesystem into the static pod component that corresponds to the prefixed name.</p>
<div class="highlight"><pre><span></span><code>   --kube-apiserver-extra-mount value            (components) kube-apiserver extra volume mounts [$RKE2_KUBE_APISERVER_EXTRA_MOUNT]
   --kube-scheduler-extra-mount value            (components) kube-scheduler extra volume mounts [$RKE2_KUBE_SCHEDULER_EXTRA_MOUNT]
   --kube-controller-manager-extra-mount value   (components) kube-controller-manager extra volume mounts [$RKE2_KUBE_CONTROLLER_MANAGER_EXTRA_MOUNT]
   --kube-proxy-extra-mount value                (components) kube-proxy extra volume mounts [$RKE2_KUBE_PROXY_EXTRA_MOUNT]
   --etcd-extra-mount value                      (components) etcd extra volume mounts [$RKE2_ETCD_EXTRA_MOUNT]
   --cloud-controller-manager-extra-mount value  (components) cloud-controller-manager extra volume mounts [$RKE2_CLOUD_CONTROLLER_MANAGER_EXTRA_MOUNT]
</code></pre></div>
<h3 id="rw-host-path-volume-mount">RW Host Path Volume Mount<a class="headerlink" href="#rw-host-path-volume-mount" title="Permanent link">&para;</a></h3>
<p><code>/source/volume/path/on/host:/destination/volume/path/in/staticpod</code></p>
<h3 id="ro-host-path-volume-mount">RO Host Path Volume Mount<a class="headerlink" href="#ro-host-path-volume-mount" title="Permanent link">&para;</a></h3>
<p>In order to mount a volume as read only, append <code>:ro</code> to the end of the volume mount.
<code>/source/volume/path/on/host:/destination/volume/path/in/staticpod:ro</code></p>
<p>Multiple volume mounts can be specified for the same component by passing the flag values as an array in the config file.</p>
<h2 id="extra-control-plane-component-environment-variables">Extra Control Plane Component Environment Variables<a class="headerlink" href="#extra-control-plane-component-environment-variables" title="Permanent link">&para;</a></h2>
<p>The following options are available under the <code>server</code> sub-command for RKE2. These options specify additional environment variables in standard format i.e. <code>KEY=VALUE</code> for the static pod component that corresponds to the prefixed name.</p>
<div class="highlight"><pre><span></span><code>   --kube-apiserver-extra-env value              (components) kube-apiserver extra environment variables [$RKE2_KUBE_APISERVER_EXTRA_ENV]
   --kube-scheduler-extra-env value              (components) kube-scheduler extra environment variables [$RKE2_KUBE_SCHEDULER_EXTRA_ENV]
   --kube-controller-manager-extra-env value     (components) kube-controller-manager extra environment variables [$RKE2_KUBE_CONTROLLER_MANAGER_EXTRA_ENV]
   --kube-proxy-extra-env value                  (components) kube-proxy extra environment variables [$RKE2_KUBE_PROXY_EXTRA_ENV]
   --etcd-extra-env value                        (components) etcd extra environment variables [$RKE2_ETCD_EXTRA_ENV]
   --cloud-controller-manager-extra-env value    (components) cloud-controller-manager extra environment variables [$RKE2_CLOUD_CONTROLLER_MANAGER_EXTRA_ENV]
</code></pre></div>
<p>Multiple environment variables can be specified for the same component by passing the flag values as an array in the config file.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../helm/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Helm Integration" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Helm Integration
            </div>
          </div>
        </a>
      
      
        
        <a href="../subcommands/" class="md-footer__link md-footer__link--next" aria-label="Next: Subcommands" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Subcommands
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.37e9125f.min.js"></script>
      
    
  </body>
</html>